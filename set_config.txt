Instalar bibliotecas:
alt + ctrl + s

vai em project: nome_projeto >> python interpreter >> + >> pesquisar bibliotecas

- Flask
- Flask-Migration >> specify version = 2.5.2
- Flask-Restful
- SQLAlchemy
- Flask-SQLAlchemy
- marshmallow
- Marshmallow-sqlalchemy
- Flask-masrshmallow
- mysqlclient

1- Dentro do __init__.py da pasta api vai ter a principal montagem:
    from flask import Flask
    from flask_restful import Api

    app = Flask(__name__)
    app.config.from_object('config')  # puchando o arquivo config.py

    api = Api(app)

2- crie um arquivo na raiz chamado config.py que vai receber alguma configurações padrões
   isso vai ajudar a separar e deixar mais consolidado a api, o primeiro config é:
        - DEBUG = True

        - Depois vamos configurar o acesso do banco:
            USERNAME = 'root'
            PASSWORD = 'essaeasenha'
            SERVER = 'localhost'
            DB = 'api_flask'
            SQLALCHEMY_DATABASE_URI = f'mysql://{USERNAME}:{PASSWORD}@{SERVER}/{DB}'
            SQLALCHEMY_TRACK_MODIFICATIONS = True

3- Vamos criar um arquivo que vai rodar nossa api, dentro da pasta api cria um arquivo chamado
   run.py:
        from api import app

        if __name__ == "__main__":
            app.run()

4- Dentro de views vamos criar um arquivo chamado curso_views, aqui vamos chamar por exemplo
   o metodo get:
        from flask_restful import Resource
        from api import api


        class CursoList(Resource):
            def get(self):
                return "Olá Mundo"


        api.add_resource(CursoList, '/cursos')

5- Dentro do arquivo __init__.py da pasta api é onde vamos chamar todas as views que criarmos,
   então la dentro:
        - from .views import curso_views

6- Volte la no __init__.py e vamos importar algumas bibliotecas e acrescentar algumas alterações:
    from flask import Flask
    from flask_restful import Api
    from flask_sqlalchemy import SQLAlchemy
    from flask_migrate import Migrate


    app = Flask(__name__)
    app.config.from_object('config')  # puchando o arquivo config.py

    # banco de dados
    db = SQLAlchemy(app)
    # config do db
    migrate = Migrate(app, db)

    api = Api(app)

    from .views import curso_views

7- Vamos em models e criar um arquivo chamado curso_model.py, onde vamos criar a primeira tabela:
       from api import db


        class Curso(db.Model):
            __tablename__ = 'curso'
            id = db.Column(db.Integer, primary_key=True,
                           autoincrement=True, nullable=False)
            nome = db.Column(db.String(50), nullable=False)
            descricao = db.Column(db.String(100), nullable=False)
            data_publicacao = db.Column(db.Date, nullable=False)

8- Sempre que criar um novo arquivo em models tem que colocar no arquivo __init__.py
   da pasta api:
        - from .models import curso_model

9- Como criamos a nova tabela em models temos que criar no banco, ou seja fazer uma migration,
   primeiro você tem que esta dentro da pasta onde esta seu app, depois esta com a venv ativada,
   depois disso configurado no terminal você vai digitar:
    - (venv) C:\Users\borge\OneDrive\Documentos\Repos\API_estruturada_2023\venv\Scripts>set FLASK_APP=api.py

    depois:

    - (venv) C:\Users\borge\OneDrive\Documentos\Repos\API_estruturada_2023>flask db init (Cria uma pasta migration)

    depois:

    - (venv) C:\Users\borge\OneDrive\Documentos\Repos\API_estruturada_2023>flask db migrate (Cria o arquivo migration)

    Agora para criar a tabela execute:

    - (venv) C:\Users\borge\OneDrive\Documentos\Repos\API_estruturada_2023>flask db upgrade

10- Vamos criar o schema para validação do dados, vamos em __init__.py na pasta api e adcionar a biblioteca Marshmallow:
    from flask import Flask
    from flask_restful import Api
    from flask_sqlalchemy import SQLAlchemy
    from flask_migrate import Migrate
    from flask_marshmallow import Marshmallow


    app = Flask(__name__)
    app.config.from_object('config')  # puchando o arquivo config.py

    # banco de dados
    db = SQLAlchemy(app)
    ma = Marshmallow(app)
    # config do db
    migrate = Migrate(app, db)

    api = Api(app)

    from .views import curso_views
    from .models import curso_model

11- Depois de chamar a biblioteca acima vamos na pasta schemas e criar um arquivo curso_schema.py, aqui vamos realizar
    realmente a validação dos dados:
        from api import ma
        from ..models import curso_model
        from marshmallow import fields


        class CursoSchema(ma.SQLAlchemyAutoSchema):
            class Meta:
                model = curso_model.Curso
                load_instance = True
                filds = ('id', 'nome', 'descricao', 'data_publicacao')

            nome = fields.String(required=True)
            descricao = fields.String(required=True)
            data_publicacao = fields.Date(required=True)

12- Depois vamos na pasta entidade e criar um arquivo curso.py:
        class Curso():
            def __int__(self, nome, descricao, data_publicacao):
                self.__nome = nome
                self.__descricao = descricao
                self.__data_publicacao = data_publicacao

            @property
            def nome(self):
                return self.__nome

            @nome.setter
            def nome(self, nome):
                self.__nome = nome

            @property
            def descricao(self):
                return self.__descricao

            @nome.setter
            def nome(self, descricao):
                self.__descricao = descricao

            @property
            def data_publicacao(self):
                return self.__data_publicacao

            @nome.setter
            def nome(self, data_publicacao):
                self.__data_publicacao = data_publicacao

13- Agora vamos criar um arquivo chamado curso_service.py na pasta service, ela vai ser usada para o arquivo
    se comunicar diretamento com SQLAlchimy:
        from ..models import curso_model
        from api import db


        def cadatrar_curso(curso):
            curso_bd = curso_model.Curso(nome=curso.nome,
                                         descricao=curso.descricao,
                                         data_publicacao=curso.data_publicacao)
            db.session.add(curso_bd)
            db.session.commit()
            return curso_bd

14- Depois de todas as configurações feitas anteriores vamos focar em dois arquivos, o __init__.py e o
    curso_views.py para começar a criar o CRUD, cadastrando curso.

15- Para cadastrar o curso vamo em curso_views.py e importa:
        - from ..schemas import curso_schema
        - from flask import request, make_response, jsonify
        - from ..entidades import curso
        - from ..services import curso_service

    Agora vamos criar nossas funções para cadastras com o metodo post:
        class CursoList(Resource):
        def get(self):
            return "Olá Mundo"

        # cadastrar
        def post(self):
            # validar a tipagem do input
            cs = curso_schema.CursoSchema()
            validate = cs.validate(request.json)

            # se tiver erro
            if validate:
                return make_response(jsonify(validate), 400)
            else:
                nome = request.json["nome"]
                descricao = request.json["descricao"]
                data_publicacao = request.json["data_publicacao"]

                novo_curso = curso.Curso(nome=nome,
                                         descricao=descricao,
                                         data_publicacao=data_publicacao)
                resultado = curso_service.cadatrar_curso(novo_curso)
                x = cs.jsonify(resultado)

                return make_response(x, 201)

16- Vamos listar os dados no banco, dentro de curso_service.py crie uma função que vai chamar esses dados:
        def listar_cursos():
        cursos = curso_model.Curso.query.all()
        return cursos

        - Depois vai em curso_views.py e na função get que já existe faça alteração chamando a lista_cursos:
                def get(self):
                    cursos = curso_service.listar_cursos()
                    cs = curso_schema.CursoSchema(many=True)
                    return make_response(cs.jsonify(cursos), 200)































